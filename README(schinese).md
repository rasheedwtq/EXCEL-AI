# Excel AI函数助手 使用说明

## 功能概述
本工具为 Excel 提供与 AI 模型交互的核心功能，能够在 Excel 中通过函数的方式使用 AI 处理单元格内容，且支持批量数据操作，大幅提升数据处理效率。

## 亮点功能
1.  **一键配置**：通过 `SetupMyAI` 宏快速配置 API Key、模型和端点，支持各类大模型（需自行申请相关大模型的 API Key）。
2.  **动态调用**：支持单个单元格和区域数据的 AI 处理。
3.  **错误处理**：自动捕获并提示 API 调用中的错误信息。

## 使用说明
1.  打开 Excel 工作簿，按 `Alt+F11` 打开 VBA 编辑器。
2.  在 VBA 编辑器中，选择“文件” -> “导入文件...”，导入 `EXCEL AI.bas` 模块文件。
3.  关闭 VBA 编辑器，返回 Excel 界面，按 `Alt+F8`，选择并运行 `SetupMyAI` 宏。
4.  根据提示，依次配置模型名称、API 端点（地址）和 API Key。
5.  使用 `AI_PROCESS(cellData As Range, prompt As String)` 函数处理单个单元格或区域。
6.  (可选) 如需重置配置，运行 `ResetAIConfig` 宏可更换模型或 API Key。

## 重要提示
1.  为便于多次使用，工具会自动存储模型配置，避免重复输入。
2.  **保存工作簿**：如需长期使用包含此配置的工作簿，请将其保存为 `.xlsm`（启用宏的工作簿）格式。下次打开时，仅需运行 `SetupMyAI` 宏即可加载配置，无需重新输入。
3.  **安全风险**：API Key 和模型信息存储在名为 `_AIConfig_` 的**隐藏工作表**中。**分享或发布此类工作簿存在严重的 API Key 泄露风险！**
4.  **即时存储风险**：在普通 `.xlsx` 文件中运行 `SetupMyAI` 配置后，即使不保存为 `.xlsm`，API Key 和模型信息**也会存储在隐藏工作表中**，同样存在泄露风险。
5.  **安全分享建议**：如需分享处理结果：
    *   先将包含 `AI_PROCESS` 函数结果的单元格**复制**。
    *   然后**选择性粘贴 -> 值**（将函数结果转换为静态值）。
    *   最后，仅将包含**结果值**的工作表复制到新的工作簿中进行分享。

## 操作技巧
1.  **保存配置**：`SetupMyAI` 宏运行成功后，配置自动保存到隐藏工作表 `_AIConfig_`。
2.  **处理规模**：受限于大模型的上下文窗口和处理能力，**请控制批量处理的单元格数量以及每个单元格内的文本长度**。
3.  **适用场景**：**不建议**使用大模型执行简单计算（如求和、平均值、计数等），Excel 内置函数更快捷、准确且无幻觉风险。AI 函数更适合文本加工、理解、生成、翻译、摘要、分析等复杂任务。
4.  **优化提示词**：为确保输出简洁可用，可在提示词结尾添加类似“**直接输出结果，不要解释或过程**”的指令。例如：“分析以下文本的情感倾向，直接输出结果（积极/消极/中性），不要解释过程”。

## 实际应用示例
### 单元格直接调用 AI 函数
1.  **归纳总结**：
    *   A1 单元格输入文本。
    *   B1 单元格输入公式：
        `=AI_PROCESS(A1, "将以下文本归纳总结为100字摘要，直接输出结果，不要解释过程")`
    *   **输出**：B1 单元格显示摘要结果。

2.  **翻译文本**：
    *   A2 单元格输入中文。
    *   B2 单元格输入公式：
        `=AI_PROCESS(A2, "将以下文本翻译成英文，直接输出结果，不要解释过程")`
    *   **输出**：B2 单元格显示英文翻译结果。

3.  **情感分析**：
    *   A3 单元格输入评论。
    *   B3 单元格输入公式：
        `=AI_PROCESS(A3, "分析以下文本的情感倾向，直接输出结果（积极/消极/中性），不要解释过程")`
    *   **输出**：B3 单元格显示情感分析结果（如“积极”）。

### 跨单元格动态处理
*   **示例**：A 列输入文本，B 列批量生成摘要：
    1.  在 B1 单元格输入公式：
        `=AI_PROCESS(A1, "归纳总结以下内容，直接输出结果，不要解释过程")`
    2.  选中 B1 单元格，向下拖动填充柄（单元格右下角的小方块），公式将自动填充至下方单元格并处理对应的 A 列数据。

### 范围数据处理
*   **示例**：分析 A1:A10 区域（包含数字序列）的趋势：
    1.  在 B1 单元格输入公式 (使用 `AI_PROCESS`)：
        `=AI_PROCESS(A1:A10, "分析该数据序列的趋势（如递增、递减、波动等）")`
    2.  **输出**：B1 单元格显示对 A1:A10 整体数据趋势的分析结果（如“该序列呈现稳定的线性递增趋势”）。

## 常见问题
1.  **API 调用失败**：
    *   检查 API Key 是否正确且未过期。
    *   检查模型名称和端点 URL 是否配置正确，且与所选模型匹配。
    *   确认网络连接正常，可以访问 API 端点。
    *   查看 Excel 状态栏或弹出的错误提示信息。
2.  **函数返回错误值（如 #VALUE!）**：
    *   检查 `cellData` 参数引用的单元格或区域是否有效。
    *   检查 `prompt` 参数是否是一个有效的文本字符串。
    *   确保已正确运行 `SetupMyAI` 宏完成配置。
3.  **结果不符合预期**：
    *   优化提示词（Prompt），使其更清晰、具体，并包含“直接输出结果”等约束指令。
    *   检查输入数据是否在模型的理解能力范围内。
    *   尝试简化任务或减少单次处理的数据量。
4.  **隐藏工作表 `_AIConfig_` 不见了或误删**：
    *   需要重新运行 `SetupMyAI` 宏进行配置。该表会在配置时自动重建。